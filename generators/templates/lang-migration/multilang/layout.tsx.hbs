import { getDictionary } from '@/i18n/dictionaries';
import { LocaleProvider } from '@/contexts/locale-context';

import * as footerData from '@/components/organisms/Footer/data';
import * as mainNavData from '@/components/organisms/MainNav/data';
import { Footer, MainNav } from '@/components/organisms';
import { Gdpr } from '@/components/molecules/Gdpr';

export const revalidate = 3600; // revalidate the data at most every hour

export default async function Layout({
	params,
	children,
}: {
	children: React.ReactNode;
	params: NextParams;
}) {
	const { lang } = await params;

	const dictionary = await getDictionary(lang);

	const [navPromise, footerPromise] = await Promise.allSettled([
		mainNavData.getData({language: lang}),
		footerData.getData({language: lang}),
	]);

	const mainNavProps =
		navPromise.status === 'fulfilled' ? navPromise.value : null;
	const footerProps =
		footerPromise.status === 'fulfilled' ? footerPromise.value : null;

	return (
		<LocaleProvider locale={lang} dictionary={dictionary}>
			{mainNavProps ? <MainNav {...mainNavProps} /> : null}
			<div className="main">{children}</div>
			{footerProps ? <Footer {...footerProps} /> : null}
			<Gdpr />
		</LocaleProvider>
	);
}
